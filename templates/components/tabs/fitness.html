<div x-show="currentTab === 'fitness'" class="max-w-6xl mx-auto space-y-6 animate-scale-in pb-24">

    <!-- Header -->
    <div class="flex justify-between items-center">
        <div>
            <h2 class="text-2xl font-bold tracking-tight">Training Lab</h2>
            <p class="text-white/40 text-xs mt-1">Bio-Individualized Protocol</p>
        </div>
        <div class="flex gap-2">
             <button @click="openFitnessWizard" class="px-3 py-1.5 rounded-lg bg-white/5 hover:bg-white/10 text-white text-xs font-bold border border-white/10 transition flex items-center gap-2">
                <span>‚ö°</span> Regenerate
             </button>
        </div>
    </div>

    <!-- Calendar Strip -->
    <div class="flex gap-2 overflow-x-auto custom-scroll snap-x py-2">
        <template x-for="day in calendarDays">
            <button @click="selectDate(day)"
                    class="flex-shrink-0 w-14 h-16 rounded-xl flex flex-col items-center justify-center gap-0.5 transition-all duration-300 snap-center border"
                    :class="day.active ? 'bg-orange-600 border-orange-500 text-white shadow-lg shadow-orange-900/40' : 'bg-white/5 border-transparent text-white/40 hover:bg-white/10 hover:text-white'">
                <span class="text-[10px] font-bold uppercase tracking-wider" x-text="day.day"></span>
                <span class="text-lg font-bold" x-text="day.date"></span>
                <div x-show="day.isToday" class="w-1 h-1 rounded-full bg-orange-400 mt-1"></div>
            </button>
        </template>
    </div>

    <!-- Main Content Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

        <!-- Left: Workout Session -->
        <div class="lg:col-span-2 space-y-6">
             <template x-for="workout in workoutPlan">
                <div x-show="workout.day === calendarDays.find(d => d.active)?.day" class="animate-scale-in space-y-6">

                    <!-- Workout Header Card -->
                    <div class="glass-card p-6 rounded-[24px] relative overflow-hidden">
                        <div class="absolute top-0 right-0 w-64 h-64 bg-orange-500/10 blur-[80px] rounded-full pointer-events-none"></div>
                        <div class="relative z-10">
                            <div class="flex justify-between items-start mb-4">
                                <div class="px-2 py-0.5 rounded-md bg-orange-500/20 text-orange-400 text-[10px] font-bold uppercase tracking-wider border border-orange-500/20" x-text="workout.focus"></div>
                                <div class="text-xs text-white/40 font-mono" x-text="workout.benefit"></div>
                            </div>
                            <h3 class="text-3xl font-extrabold text-white mb-2">Today's Session</h3>
                            <div class="flex gap-4 text-xs text-white/50">
                                <div class="flex items-center gap-1"><span>‚è±Ô∏è</span> 60m Est.</div>
                                <div class="flex items-center gap-1"><span>üî•</span> 450 Kcal</div>
                                <div class="flex items-center gap-1"><span>üìä</span> <span x-text="calculateSessionVolume(workout) + ' kg Vol'"></span></div>
                            </div>
                        </div>

                        <!-- Warmup Mini-Section -->
                         <template x-if="workout.warmup && workout.warmup.length">
                            <div class="mt-6 pt-4 border-t border-white/5">
                                <div class="text-[10px] font-bold text-white/30 uppercase mb-2">Warm Up</div>
                                <div class="flex flex-wrap gap-2">
                                    <template x-for="warm in workout.warmup">
                                        <div class="px-2 py-1 rounded bg-white/5 border border-white/5 text-[10px] text-white/60" x-text="warm"></div>
                                    </template>
                                </div>
                            </div>
                        </template>
                    </div>

                    <!-- Exercises List -->
                    <div class="space-y-4">
                        <template x-for="(ex, exIdx) in workout.exercises">
                            <div class="glass-card rounded-[20px] overflow-hidden border border-white/5" x-data="{ expanded: true }">
                                <!-- Exercise Header -->
                                <div class="p-4 bg-white/5 flex justify-between items-center cursor-pointer hover:bg-white/10 transition" @click="expanded = !expanded">
                                    <div class="flex items-center gap-3">
                                        <div class="w-6 h-6 rounded-full bg-orange-500/10 text-orange-400 flex items-center justify-center text-xs font-bold" x-text="exIdx + 1"></div>
                                        <div>
                                            <div class="font-bold text-sm" x-text="ex.name || ex"></div>
                                            <div class="text-[10px] text-white/40" x-text="(ex.setLogs.length) + ' Sets ‚Ä¢ Target: ' + (ex.reps || '8-12') + ' Reps'"></div>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <div x-show="getExerciseHistory(ex.name)" class="hidden sm:block text-[10px] px-2 py-0.5 rounded bg-blue-500/10 text-blue-400 border border-blue-500/20">
                                            Best: <span x-text="getExerciseHistory(ex.name)"></span>
                                        </div>
                                        <div class="transform transition-transform" :class="expanded ? 'rotate-180' : ''">‚ñº</div>
                                    </div>
                                </div>

                                <!-- Exercise Details (Sets) -->
                                <div x-show="expanded" class="p-4 bg-black/20">
                                    <div class="space-y-2">
                                        <!-- Header Row -->
                                        <div class="grid grid-cols-10 gap-2 text-[10px] text-white/30 font-bold uppercase tracking-wider text-center mb-1">
                                            <div class="col-span-1">Set</div>
                                            <div class="col-span-3">Prev</div>
                                            <div class="col-span-2">Kg</div>
                                            <div class="col-span-2">Reps</div>
                                            <div class="col-span-2">Done</div>
                                        </div>

                                        <!-- Set Rows -->
                                        <template x-for="(set, setIdx) in ex.setLogs">
                                            <div class="grid grid-cols-10 gap-2 items-center" :class="set.completed ? 'opacity-50' : ''">
                                                <div class="col-span-1 flex justify-center">
                                                    <div class="w-5 h-5 rounded bg-white/5 flex items-center justify-center text-[10px] text-white/50" x-text="setIdx + 1"></div>
                                                </div>
                                                <div class="col-span-3 text-center">
                                                    <div class="text-[10px] text-white/30" x-text="getExerciseHistory(ex.name) || '-'"></div>
                                                </div>
                                                <div class="col-span-2">
                                                    <input type="number" x-model="set.weight" placeholder="0" class="w-full bg-white/5 border border-white/10 rounded px-2 py-1 text-xs text-center focus:border-orange-500 focus:outline-none">
                                                </div>
                                                <div class="col-span-2">
                                                    <input type="number" x-model="set.reps" placeholder="0" class="w-full bg-white/5 border border-white/10 rounded px-2 py-1 text-xs text-center focus:border-orange-500 focus:outline-none">
                                                </div>
                                                <div class="col-span-2 flex justify-center">
                                                    <button @click="toggleSet(ex, setIdx); if(set.completed) startRest(90);" class="w-6 h-6 rounded border transition flex items-center justify-center"
                                                            :class="set.completed ? 'bg-green-500 border-green-500 text-white' : 'border-white/20 hover:border-white/50 text-transparent'">
                                                        <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path d="M5 13l4 4L19 7"></path></svg>
                                                    </button>
                                                </div>
                                            </div>
                                        </template>
                                    </div>

                                    <!-- Tip and Rest -->
                                    <div class="mt-4 pt-3 border-t border-white/5 flex justify-between items-center">
                                        <div class="text-[10px] text-white/40 italic truncate max-w-[200px]" x-text="'üí° ' + (ex.tip || 'Keep core tight')"></div>
                                        <button @click="startRest(90)" class="text-[10px] text-orange-400 hover:text-orange-300 font-bold flex items-center gap-1">
                                            <span>‚è±Ô∏è</span> Rest 90s
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>

                    <!-- Finish Workout -->
                    <div class="pt-6 pb-12">
                         <button @click="finishWorkout(workout)" class="w-full py-4 rounded-xl bg-green-600 hover:bg-green-500 text-white font-bold shadow-lg shadow-green-900/20 transition-all transform hover:scale-[1.02]">
                             Finish Workout & Save Progress
                         </button>
                    </div>

                </div>
             </template>

             <!-- Empty State -->
             <div x-show="!workoutPlan.length" class="p-12 text-center text-white/40 border border-dashed border-white/10 rounded-[32px] bg-white/5">
                <div class="text-4xl mb-4">üèãÔ∏è</div>
                <h3 class="text-lg font-bold text-white mb-2">No Plan Active</h3>
                <p class="text-sm mb-6">Create a new split to get started.</p>
                <button @click="openFitnessWizard" class="px-6 py-2 rounded-lg bg-orange-600 text-white font-bold hover:bg-orange-500 transition">Create Plan</button>
             </div>
        </div>

        <!-- Right: Sidebar & Tools -->
        <div class="space-y-6">

            <!-- Recovery Card -->
            <div class="glass-card p-5 rounded-[24px]">
                <h4 class="font-bold text-xs text-white/50 mb-4 uppercase tracking-wider">Recovery Status</h4>
                <div class="flex items-end gap-2 mb-2">
                    <div class="text-3xl font-bold text-green-400">92%</div>
                    <div class="text-xs text-white/40 mb-1">Recovered</div>
                </div>
                <div class="w-full h-1 bg-white/10 rounded-full overflow-hidden">
                    <div class="w-[92%] h-full bg-green-500 rounded-full"></div>
                </div>
                <p class="text-[10px] text-white/40 mt-3">Ready for high intensity output.</p>
            </div>

            <!-- Volume Chart Placeholder -->
            <div class="glass-card p-5 rounded-[24px]">
                 <h4 class="font-bold text-xs text-white/50 mb-4 uppercase tracking-wider">Weekly Volume</h4>
                 <div class="h-32 flex items-end justify-between gap-2">
                     <!-- Fake Bars for visual only, Chart.js can be connected later -->
                     <div class="w-full bg-white/5 rounded-t hover:bg-orange-500/20 transition h-[40%]"></div>
                     <div class="w-full bg-white/5 rounded-t hover:bg-orange-500/20 transition h-[60%]"></div>
                     <div class="w-full bg-orange-500 rounded-t hover:bg-orange-400 transition h-[80%] relative group">
                         <div class="absolute -top-6 left-1/2 -translate-x-1/2 text-[10px] bg-black px-1 rounded opacity-0 group-hover:opacity-100 transition">Today</div>
                     </div>
                     <div class="w-full bg-white/5 rounded-t hover:bg-orange-500/20 transition h-[30%]"></div>
                     <div class="w-full bg-white/5 rounded-t hover:bg-orange-500/20 transition h-[50%]"></div>
                 </div>
            </div>

            <!-- Tools Grid -->
            <div>
                <h4 class="font-bold text-xs text-white/50 mb-4 uppercase tracking-wider">Tools</h4>
                <div class="grid grid-cols-2 gap-3">
                    <template x-for="tool in fitnessTools">
                        <button @click="selectedTool = tool; bioHacksOpen = true" class="glass-card p-3 rounded-xl text-left hover:bg-white/5 transition border border-white/5 hover:border-white/10">
                            <div class="text-lg mb-1" x-text="tool.icon || '‚öôÔ∏è'"></div>
                            <div class="font-bold text-xs truncate" x-text="tool.name"></div>
                        </button>
                    </template>
                </div>
            </div>
        </div>
    </div>
</div>
