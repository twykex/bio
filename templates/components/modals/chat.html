<div class="ai-tooltip" :class="tooltipVisible ? 'visible' : ''" :style="`top: ${tooltipY}px; left: ${tooltipX}px`">
    <span class="text-brand-blue text-[10px] font-bold uppercase block mb-1">AI Insight</span>
    <span x-text="tooltipText"></span>
</div>

<div class="fixed inset-y-0 right-0 w-[450px] bg-[#050505]/95 backdrop-blur-2xl border-l border-white/10 z-[60] transform transition-transform duration-500 shadow-2xl flex flex-col translate-x-full"
     :class="chatOpen ? 'translate-x-0' : 'translate-x-full'" x-cloak>

    <!-- Header -->
    <div class="p-6 border-b border-white/5 flex justify-between items-center bg-white/[0.02]">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-brand-blue/10 flex items-center justify-center text-lg shadow-[0_0_15px_rgba(59,130,246,0.2)]">ðŸ§¬</div>
            <div>
                <h3 class="font-bold text-white tracking-tight">BioFlow Assistant</h3>
                <div class="flex items-center gap-1.5 mt-0.5">
                    <span class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></span>
                    <span class="text-[10px] text-white/40 uppercase font-bold tracking-wider">Online</span>
                </div>
            </div>
        </div>
        <button @click="chatOpen = false" class="w-8 h-8 rounded-lg bg-white/5 hover:bg-white/10 flex items-center justify-center text-white/50 hover:text-white transition">âœ•</button>
    </div>

    <!-- Chat Area -->
    <div class="flex-1 overflow-y-auto p-6 space-y-6 custom-scroll" id="chat-container">
        <!-- Welcome Message -->
         <div class="flex gap-4">
            <div class="w-8 h-8 rounded-full bg-brand-blue/10 flex-shrink-0 flex items-center justify-center text-xs">ðŸ§¬</div>
            <div class="px-5 py-3.5 text-sm leading-relaxed rounded-2xl rounded-tl-none max-w-[85%] bg-white/5 border border-white/10 text-white/90 shadow-sm">
                 Hello! I'm your biological optimization assistant. Ask me about your bloodwork, diet, or training.
            </div>
        </div>

        <template x-for="msg in chatHistory">
            <div class="flex gap-4 animate-scale-in origin-bottom" :class="msg.role === 'user' ? 'flex-row-reverse' : ''">
                 <!-- Avatar -->
                 <div class="w-8 h-8 rounded-full flex-shrink-0 flex items-center justify-center text-xs"
                      :class="msg.role === 'user' ? 'bg-white/10 text-white' : 'bg-brand-blue/10 text-brand-blue'"
                      x-show="!msg.typing">
                      <span x-text="msg.role === 'user' ? 'ðŸ‘¤' : 'ðŸ§¬'"></span>
                 </div>

                <!-- Bubble -->
                <div class="px-5 py-3.5 text-sm leading-relaxed max-w-[85%] shadow-sm relative group"
                     :class="[
                        msg.role === 'user' ? 'bg-brand-blue text-white rounded-2xl rounded-tr-none' : 'bg-white/5 border border-white/10 text-white/90 rounded-2xl rounded-tl-none',
                        msg.typing ? 'typing-cursor' : ''
                     ]">
                     <span x-html="msg.text.replace(/\n/g, '<br>')"></span>
                </div>
            </div>
        </template>
    </div>

    <!-- Input Area -->
    <div class="p-6 border-t border-white/5 bg-black/40 backdrop-blur-md">
        <form @submit.prevent="sendMessage" class="relative group">
            <input type="text" x-model="chatInput" placeholder="Ask anything..." class="w-full bg-white/5 border border-white/10 rounded-2xl pl-5 pr-12 py-4 text-sm text-white focus:outline-none focus:border-brand-blue/50 focus:bg-white/10 transition-all placeholder:text-white/20 shadow-inner">
            <button type="submit" class="absolute right-2 top-2 bottom-2 w-10 rounded-xl bg-brand-blue hover:bg-blue-600 text-white flex items-center justify-center transition-all shadow-lg shadow-brand-blue/20 transform active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed" :disabled="!chatInput.trim()">
                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
            </button>
        </form>
    </div>
</div>